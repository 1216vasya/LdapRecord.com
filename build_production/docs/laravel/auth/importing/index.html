<!DOCTYPE html>
<html lang="en" class="h-full">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Running the import command">

        <meta property="og:site_name" content="LdapRecord"/>
        <meta property="og:title" content="Importing Users | LdapRecord"/>
        <meta property="og:description" content="Running the import command"/>
        <meta property="og:url" content="https://ldaprecord.com/docs/laravel/auth/importing"/>
        <meta property="og:image" content="/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="LdapRecord">
        <meta name="twitter:card" content="summary_large_image">

                    <meta name="generator" content="tighten_jigsaw_doc">
        
        <title>LdapRecord | Importing Users</title>

        <link rel="home" href="https://ldaprecord.com">
        <link rel="icon" href="/favicon.ico">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">

        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Permanent+Marker&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=fd3e85050bc0cec2d319">

                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
            </head>
    <body class="h-full flex flex-col bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center h-24 py-12 z-20 relative border-t-8 border-purple-600 bg-white mb-2" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="LdapRecord home" class="inline-flex items-center">
                        <img class="h-20 md:h-24 mr-3" src="/assets/img/logo.svg" alt="LdapRecord logo" />
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10 text-blue-800">
                                            <button
    title="Start searching"
    type="button"
    class="flex md:hidden bg-gray-100 hover:bg-blue-100 justify-center items-center border border-gray-500 rounded-full focus:outline-none h-10 px-3"
    onclick="searchInput.toggle()"
>
    <img src="/assets/img/magnifying-glass.svg" alt="search icon" class="h-4 w-4 max-w-none">
</button>

<div id="js-search-input" class="docsearch-input__wrapper hidden md:block">
    <label for="search" class="hidden">Search</label>

    <input
        id="docsearch-input"
        class="docsearch-input relative block h-10 transition-fast w-full lg:w-1/2 xl:w-1/3 bg-gray-100 outline-none rounded-full text-gray-700 border border-gray-500 focus:border-blue-400 ml-auto px-4 pb-0"
        name="docsearch"
        type="text"
        placeholder="Search"
    >

    <button
        class="md:hidden absolute right-0 mr-8 h-full font-light text-3xl text-blue-500 hover:text-blue-600 focus:outline-none -mt-px"
        onclick="searchInput.toggle()"
    >&times;</button>
</div>

                    
                                            <a href="/docs/" class="ml-6 hidden md:inline whitespace-no-wrap text-blue-800" title="LdapRecord Documentation Link">
                            Core Docs
                        </a>

                        <a href="https://github.com/DirectoryTree/LdapRecord-Laravel" class="hidden sm:inline text-blue-800">
                            <svg class="fill-current w-8 ml-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg>
                        </a>
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-purple-500 border border-purple-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full">
                <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
        <div class="flex flex-col lg:flex-row">
            <nav id="js-nav-menu" class="nav-menu hidden lg:block">
                    <ul class="list-none my-0 ">
            <li class="pl-4">
            
        <a href="/docs/laravel/quickstart"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Quickstart
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Overview
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/installation"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/usage"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Usage
        </a>
    
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-500 font-extrabold text-xs tracking-widest uppercase italic pt-2">Authentication</p>
    
            
        <ul class="list-none my-0 border-l-4 border-purple-200">
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/quickstart"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Quickstart
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Overview
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/installation"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/configuration"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Configuration
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/usage"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Usage
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/multi-domain"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Multi-Domain
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/importing"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            Importing Users
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/testing"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Testing
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/testing"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Testing
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/versioning"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Versioning
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/license"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            License
        </a>
    
    </li>
    </ul>

    <div class="block sm:hidden">
        <hr class="my-4"/>

        <ul class="list-none my-0">
            <li class="pl-4">
                <a href="/docs/"
                   class="nav-menu__item hover:text-blue-500"
                >
                    Core Documentation
                </a>
            </li>

            <li class="pl-4">
                <a href="https://github.com/DirectoryTree/LdapRecord-Laravel"
                   class="nav-menu__item hover:text-blue-500"
                >
                    Source Code
                </a>
            </li>
        </ul>
    </div>
            </nav>

            <div class="DocSearch-content content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
                <h1>Importing Users</h1>
<ul>
<li><a href="#running-the-command">Running the command</a></li>
<li><a href="#scheduling-the-command">Scheduling the command</a></li>
<li><a href="#single-users">Single Users</a></li>
<li><a href="#command-options">Command Options</a></li>
<li><a href="#tips">Additional Tips</a></li>
</ul>
<p>LdapRecord-Laravel allows you to import users from your LDAP directories into your local database.
This is done from the <code>ldap:import</code> command and only available when you configure
<a href="/docs/laravel/auth/configuration/#database">database synchronization</a>.</p>
<h2 id="running-the-command">Running the command</h2>
<p>To run the command you must insert the <code>provider</code> name that you have setup for LDAP database synchronization
inside of your <code>config/auth.php</code> file. Let's walk through an example.</p>
<p>In our application we have a configured authentication provider named <code>ldap</code>:</p>
<pre><code class="language-php">'providers' =&gt; [
    // ...

    'ldap' =&gt; [
        // ...
        'database' =&gt; [
            // ...
        ],
    ],
],</code></pre>
<p>We will then insert the providers name into our import command and execute it:</p>
<pre><code class="language-bash">php artisan ldap:import ldap</code></pre>
<p>You will then be asked after a successful search in your directory:</p>
<pre><code class="language-text">Found 2 user(s).

Would you like to display the user(s) to be imported / synchronized? (yes/no) [no]:
&gt; y</code></pre>
<p>A table will then be shown so you can confirm the import of the located users:</p>
<pre><code class="language-text">+-------------+-------------------+---------------------+
| Name        | Account Name      | UPN                 |
+-------------+-------------------+---------------------+
| John Doe    | johndoe           | johndoe@local.com   |
| Jane Doe    | janedoe           | janedoe@local.com   |
+-------------+-------------------+---------------------+</code></pre>
<p>Then, you will be asked to import the users shown and the import will begin:</p>
<pre><code class="language-text"> Would you like these users to be imported / synchronized? (yes/no) [no]:
 &gt; y

  2/2 [============================] 100%

Successfully imported / synchronized 2 user(s).</code></pre>
<h2 id="scheduling-the-command">Scheduling the command</h2>
<p>To run the import as a scheduled job, place the following in your <code>app/Console/Kernel.php</code> in the command scheduler:</p>
<pre><code class="language-php">protected function schedule(Schedule $schedule)
{
    // Import LDAP users hourly.
    $schedule-&gt;command('ldap:import ldap', [
        '--no-interaction',
        '--restore',
        '--delete',
        '--filter' =&gt; '(objectclass=user)',
    ])-&gt;hourly();
}</code></pre>
<p>The above scheduled import command will:</p>
<ul>
<li>Run without interaction and import new users as well as synchronize already imported users</li>
<li>Restore user models who have been re-activated in your LDAP directory (if you're using <a href="https://laravel.com/docs/eloquent#soft-deleting">Eloquent Soft Deletes</a>)</li>
<li>Soft-Delete user models who have been deactived in your LDAP directory (if you're using <a href="https://laravel.com/docs/eloquent#soft-deleting">Eloquent Soft Deletes</a>)</li>
<li>Only import users that have an <code>objectclass</code> equal to user</li>
</ul>
<blockquote>
<p>It's recommended to use <a href="/docs/models#query-scopes">model query scopes</a> instead of the <code>--filter</code>
option on your configured authentication LdapRecord model so LDAP users signing into your
application are applied the same search filter.</p>
</blockquote>
<h2 id="single-users">Single Users</h2>
<p>To import or synchronize a single user, insert one of their attributes and LdapRecord will
try to locate the user for you using Ambiguous Name Resolution. If your LDAP server
does not support ANR, an equivalent query will be created automatically.</p>
<pre><code class="language-text">php artisan ldap:import ldap jdoe@email.com

Found user 'John Doe'.

Would you like to display the user(s) to be imported / synchronized? (yes/no) [no]:
&gt; y</code></pre>
<h2 id="command-options">Command Options</h2>
<h3>Filter</h3>
<p>The --filter (or -f) option allows you to enter in a raw filter to further narrow down the users who are imported:</p>
<pre><code class="language-text">php artisan ldap:import ldap --filter "(cn=John Doe)"</code></pre>
<h3>No Logging</h3>
<p>The --no-log option allows you to disable logging during the command.</p>
<pre><code class="language-text">php artisan ldap:import ldap --no-log</code></pre>
<p>By default this is enabled, regardless if <code>logging</code> is disabled in your <code>config/ldap.php</code> file.</p>
<h3>Delete</h3>
<blockquote>
<p>This option is only available on ActiveDirectory models.</p>
</blockquote>
<p>The --delete (or -d) option allows you to soft-delete deactivated LDAP users. No users
will be deleted if your <code>User</code> Eloquent model does not have soft-deletes enabled.</p>
<pre><code class="language-text">php artisan ldap:import ldap --delete</code></pre>
<h3>Restore</h3>
<blockquote>
<p>This option is only available on ActiveDirectory models.</p>
</blockquote>
<p>The --restore (or -r) option allows you to restore soft-deleted re-activated LDAP users.</p>
<pre><code class="language-text">php artisan ldap:import ldap --restore</code></pre>
<blockquote>
<p>Usually the <code>--restore</code> and <code>--delete</code> options are used in tandem to allow
full synchronization of user disablements and restoration.</p>
</blockquote>
<h3>No Interaction</h3>
<p>To run the import command via a schedule, use the <code>--no-interaction</code> flag:</p>
<pre><code class="language-text">php artisan ldap:import ldap --no-interaction</code></pre>
<p>Users will be imported automatically with no prompts.</p>
<p>You can also call the command from the Laravel Scheduler, or other commands:</p>
<pre><code class="language-php">// Importing one user
$schedule-&gt;command('ldap:import ldap sbauman', ['--no-interaction'])
            -&gt;everyMinute();

// Importing all users
$schedule-&gt;command('ldap:import ldap', ['--no-interaction'])
            -&gt;everyMinute();

// Importing users with a filter
$dn = 'CN=Accounting,OU=SecurityGroups,DC=local,DC=com';

$filter = sprintf('(memberof:1.2.840.113556.1.4.1941:=%s)', $dn);

$schedule-&gt;command('ldap:import ldap', ['--no-interaction', '--filter' =&gt; $filter])
    -&gt;everyMinute();</code></pre>
<h3 id="tips">Additional Tips</h3>
<ul>
<li>Users who already exist inside your database will be updated with your configured providers <code>sync_attributes</code></li>
<li>Users are never deleted from the import command, you will need to delete users regularly through your Eloquent model</li>
<li>Successfully imported (new) users are reported in your log files with:
<pre><code class="language-text">[2020-01-29 14:51:51] local.INFO: Imported user johndoe</code></pre></li>
<li>Unsuccessful imported users are also reported in your log files, with the message of the exception:
<pre><code class="language-text">[2020-01-29 14:51:51] local.ERROR: Unable to import user janedoe. SQLSTATE[23000]: Integrity constraint violation: 1048</code></pre></li>
<li>If you have a password mutator (setter) on your <code>User</code> Eloquent model, it will not override it.
This allows you to hash the random 16 character passwords any way you prefer.</li>
</ul>
                <div class="mt-12 pt-8 pb-6 border-t-2">
                        <div class="flex flex-col-reverse md:flex-row justify-between items-center">
    <div class="flex flex-col items-center md:items-start">
                    <span class="font-black text-gray-500 text-sm tracking-wider uppercase pb-1">← Previous Topic</span>
            <h4 class="font-bold underline m-0 text-blue-700">
                <a href="/docs/laravel/auth/multi-domain">Multi-Domain</a>
            </h4>
            </div>
    <div class="mb-8 md:mb-0 flex flex-col items-center md:items-end">
                    <span class="font-black text-gray-500 text-sm tracking-wider uppercase pb-1">Next Topic →</span>
            <h4 class="font-bold underline m-0 text-blue-700">
                <a href="/docs/laravel/auth/testing">Testing</a>
            </h4>
            </div>
</div>
                </div>
            </div>
        </div>
    </section>
        </main>

        <script src="/assets/build/js/main.js?id=4084d289e77efba0f3a9"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
            <script type="text/javascript">
            docsearch({
                apiKey: 'bc526397341486f980ca0b7ee7a0fa61',
                indexName: 'ldaprecord',
                inputSelector: '#docsearch-input',
                debug: false // Set debug to true if you want to inspect the dropdown
            });

            const searchInput = {
                toggle() {
                    const menu = document.getElementById('js-search-input');
                    menu.classList.toggle('hidden');
                    menu.classList.toggle('md:block');
                    document.getElementById('docsearch-input').focus();
                },
            }
        </script>
    
        <footer class="text-center text-sm mt-12 py-4 mt-auto" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-none">
                <li class="md:mr-2">
                    &copy; <a href="https://github.com/DirectoryTree" title="DirectoryTree GitHub">DirectoryTree</a> 2020.
                </li>

                <li class="md:mr-2">
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
